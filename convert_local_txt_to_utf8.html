<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로컬 TXT 파일 UTF-8 변환기</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #file-content {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            white-space: pre-wrap; /* 줄바꿈과 공백 유지 */
            min-height: 200px;
        }
    </style>
</head>
<body>

    <h1>로컬 TXT 파일 UTF-8 변환기</h1>
    <p>한글이 깨지는 TXT 파일을 선택하면 UTF-8로 변환된 내용을 아래에 표시합니다. (주로 EUC-KR 인코딩 파일을 변환합니다)</p>

    <input type="file" id="file-input" accept=".txt">
    <button id="save-button" disabled>변환된 파일 저장</button>

    <pre id="file-content">여기에 파일 내용이 표시됩니다.</pre>

    <script>
        const fileInput = document.getElementById('file-input');
        const saveButton = document.getElementById('save-button');
        const fileContentElement = document.getElementById('file-content');
        let originalFileName = '';

        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            originalFileName = file.name;

            const reader = new FileReader();
            
            // 파일을 읽고 나면 실행될 콜백 함수
            reader.onload = function(e) {
                // EUC-KR로 인코딩된 파일이라고 가정하고 디코딩합니다.
                try {
                    const decoder = new TextDecoder('euc-kr');
                    const content = decoder.decode(e.target.result);
                    fileContentElement.textContent = content;
                    saveButton.disabled = false; // 변환이 성공하면 저장 버튼을 활성화합니다.
                } catch (error) {
                    fileContentElement.textContent = "파일을 변환하는 중 오류가 발생했습니다.";
                    saveButton.disabled = true; // 오류 발생 시 버튼 비활성화
                }
            };

            // 파일을 ArrayBuffer 형태로 읽습니다.
            reader.readAsArrayBuffer(file);
        });

        saveButton.addEventListener('click', function() {
            const contentToSave = fileContentElement.textContent;
            const blob = new Blob([contentToSave], { type: 'text/plain;charset=utf-8' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `utf8_${originalFileName}`; // 예: k267.txt -> utf8_k267.txt
            link.click();
            URL.revokeObjectURL(link.href); // 메모리 누수 방지
        });
    </script>

</body>
</html>